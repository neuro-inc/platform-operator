suite: test cluster vault secret store
release:
  name: platform
  namespace: platform
templates:
  - cluster-vault-secret-store.yaml
values:
  - common-values.yaml
tests:
  - it: should match snapshot
    set:
      clusterSecretStore:
        vault:
          server: https://vault.apolo.us
          path: default--kv-v2
          auth:
            role: default--platform
            mountPath: default--jwt
    asserts:
      - matchSnapshot: {}
  - it: should fail without vault config
    asserts:
      - failedTemplate:
          errorMessage: vault config is required
  - it: should fail without vault server
    set:
      clusterSecretStore:
        vault:
          path: default--kv-v2
          auth:
            role: default--platform
            mountPath: default--jwt
    asserts:
      - failedTemplate:
          errorMessage: vault.server is required
  - it: should fail without vault path
    set:
      clusterSecretStore:
        vault:
          server: https://vault.apolo.us
          auth:
            role: default--platform
            mountPath: default--jwt
    asserts:
      - failedTemplate:
          errorMessage: vault.path is required
  - it: should fail without vault auth
    set:
      clusterSecretStore:
        vault:
          server: https://vault.apolo.us
          path: default--kv-v2
    asserts:
      - failedTemplate:
          errorMessage: vault.auth is required
